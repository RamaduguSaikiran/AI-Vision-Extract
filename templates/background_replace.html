{% extends "base.html" %}
{% block content %}

<div class="animate-fadeSlideIn">

    <!-- HEADER -->
    <section class="mb-10">
        <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight 
                   bg-gradient-to-r from-fuchsia-300 via-purple-400 to-sky-300
                   bg-clip-text text-transparent drop-shadow-[0_0_18px_rgba(125,211,252,0.35)]">
            Background Replace
        </h1>

        <p class="text-slate-300 text-sm md:text-base max-w-2xl mt-3 opacity-90 leading-relaxed">
            Replace the background using a solid color or a custom image, powered by AI segmentation 
            and cinematic-glow rendering.
        </p>
    </section>


    <!-- FORM PANEL -->
    <div class="ai-panel-cinematic p-[2px] rounded-[1.8rem]">
        <div class="ai-panel-inner px-6 py-7 md:px-10 md:py-10 space-y-8">

            <form method="post" enctype="multipart/form-data" class="space-y-8">

                <!-- Upload main image -->
                <div class="flex flex-col gap-3">
                    <label class="text-xs uppercase tracking-wide text-slate-300/80">
                        Upload Main Image
                    </label>

                    <input
                        type="file"
                        name="image"
                        accept="image/*"
                        required
                        class="block w-full text-xs text-slate-300 file:mr-3
                               file:bg-gradient-to-r file:from-sky-500 file:to-fuchsia-500
                               file:text-white file:font-semibold file:px-3 file:py-2
                               file:rounded-xl hover:file:scale-[1.03]
                               transition-all duration-200 cursor-pointer
                               bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-3
                               hover:bg-slate-900/80 backdrop-blur-xl"
                    />
                </div>

                <!-- MODE SWITCH -->
                <div>
                    <label class="text-xs uppercase tracking-wide text-slate-300/80">Mode</label>

                    <div class="mt-2 inline-flex rounded-2xl bg-slate-900/70 border border-slate-700 overflow-hidden text-xs shadow-lg">

                        <!-- Color Mode -->
                        <label class="cursor-pointer flex-1">
                            <input
                                type="radio"
                                name="mode"
                                value="color"
                                class="peer hidden"
                                {% if mode == "color" %}checked{% endif %}
                            />
                            <div
                                class="px-6 py-3 text-center transition-colors
                                       peer-checked:bg-gradient-to-r peer-checked:from-sky-500 peer-checked:to-fuchsia-400
                                       peer-checked:text-white text-slate-300"
                            >
                                üé® Color Replace
                            </div>
                        </label>

                        <!-- Image Mode -->
                        <label class="cursor-pointer flex-1 border-l border-slate-700">
                            <input
                                type="radio"
                                name="mode"
                                value="image"
                                class="peer hidden"
                                {% if mode == "image" %}checked{% endif %}
                            />
                            <div
                                class="px-6 py-3 text-center transition-colors
                                       peer-checked:bg-gradient-to-r peer-checked:from-fuchsia-500 peer-checked:to-purple-500
                                       peer-checked:text-white text-slate-300"
                            >
                                üñºÔ∏è Image Replace
                            </div>
                        </label>

                    </div>
                </div>

                <!-- MODE-SPECIFIC CONTROLS -->
                {% if mode == "color" %}
                <!-- COLOR PICKER -->
                <div class="flex flex-col gap-2">
                    <label class="text-xs uppercase tracking-wide text-slate-300/80">
                        Select Background Color
                    </label>

                    <input
                        type="color"
                        name="color"
                        value="{{ selected_color }}"
                        class="h-10 w-20 rounded-xl border border-slate-700 bg-slate-900 cursor-pointer"
                    />

                    <p class="text-[0.72rem] text-slate-400 mt-1">
                        The selected color will replace the background area detected by the model.
                    </p>
                </div>

                {% else %}
                <!-- BACKGROUND IMAGE UPLOAD -->
                <div class="flex flex-col gap-3">
                    <label class="text-xs uppercase tracking-wide text-slate-300/80">
                        Upload Background Image
                    </label>

                    <input
                        type="file"
                        name="bg_image"
                        accept="image/*"
                        required
                        class="block w-full text-xs text-slate-300 file:mr-3
                               file:bg-gradient-to-r file:from-purple-500 file:to-fuchsia-500
                               file:text-white file:font-semibold file:px-3 file:py-2
                               file:rounded-xl hover:file:scale-[1.03]
                               transition-all duration-200 cursor-pointer
                               bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-3
                               hover:bg-slate-900/80 backdrop-blur-xl"
                    />

                    <p class="text-[0.72rem] text-slate-400 mt-1">
                        The uploaded image will be matched to the subject and used as the new background.
                    </p>
                </div>
                {% endif %}

                <!-- SUBMIT BUTTON -->
                <div class="pt-2">
                    <button type="submit" class="ai-btn-holo" data-magnetic="true">
                        ‚ö° Apply Background
                    </button>
                </div>

            </form>

        </div>
    </div>


    <!-- RESULT PREVIEW -->
    {% if output_b64 %}
    <section class="mt-16 space-y-10">

        <h2 class="text-xl md:text-2xl font-semibold 
                   text-fuchsia-300 drop-shadow-[0_0_20px_rgba(236,72,153,0.4)]
                   border-l-4 border-fuchsia-400 pl-4">
            Result Preview
        </h2>

        <div class="grid gap-12 md:grid-cols-2">

            <!-- INPUT IMAGE -->
            <div class="flex flex-col gap-3">
                <h3 class="text-sm uppercase tracking-wide text-slate-300/90">Input Image</h3>

                <div class="ai-preview-cinematic">
                    <img
                        src="data:image/png;base64,{{ input_b64 }}"
                        alt="Input Image"
                        class="rounded-[1.4rem] w-full object-contain"
                    />
                </div>
            </div>

            <!-- OUTPUT IMAGE -->
            <div class="flex flex-col gap-4">
                <h3 class="text-sm uppercase tracking-wide text-slate-300/90">
                    Output ‚Äî {{ 'Color' if mode == 'color' else 'Image' }} Replace
                </h3>

                <div class="ai-preview-cinematic ai-preview-glow">
                    <img
                        src="data:image/png;base64,{{ output_b64 }}"
                        alt="Output Image"
                        class="rounded-[1.4rem] w-full object-contain"
                    />
                </div>

                <!-- Download -->
                <a
                    download="replaced_bg.png"
                    href="data:image/png;base64,{{ output_b64 }}"
                    class="ai-btn-secondary ai-btn-glow text-xs px-4 py-2 inline-flex"
                    data-magnetic="true"
                >
                    ‚¨á Download Output
                </a>
            </div>

        </div>
    </section>
    {% endif %}

</div>

{% endblock %}
